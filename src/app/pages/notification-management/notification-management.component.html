<div class="container-fluid">
    <app-page-title title="Notification Management"></app-page-title>

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">

                    <div *ngIf="loading">
                        <app-loader></app-loader>
                    </div>

                    <div *ngIf="!loading">
                        <div class="search-bar">
                            <div class="search-input text-end">
                                <button pButton shape="round" size="small" status="primary" (click)="openNew()">
                                    Send Notification
                                </button>
                            </div>
                        </div>
                        <div class="p-table-wrapper mt-3" *ngIf="notifications">
                            <p-table #dt [value]="notifications" [rows]="10" [paginator]="true"
                                [rowsPerPageOptions]="[10,25,50]" [rowHover]="true" dataKey="id"
                                currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                                [showCurrentPageReport]="true">
                                <ng-template pTemplate="caption">
                                    <div class="p-d-flex p-ai-center p-jc-between">
                                        <span class="p-input-icon-left">
                                            <i class="pi pi-search"></i>
                                            <input pInputText type="text"
                                                (input)="dt.filterGlobal($event.target.value, 'contains')"
                                                placeholder="Search..." />
                                        </span>
                                    </div>
                                </ng-template>
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th pSortableColumn="title">Notification Title <p-sortIcon field="title">
                                            </p-sortIcon>
                                        </th>
                                        <th pSortableColumn="message">Notification Message <p-sortIcon field="message">
                                            </p-sortIcon>
                                        </th>
                                        <th pSortableColumn="description">Notification Description <p-sortIcon
                                                field="description"></p-sortIcon>
                                        </th>
                                        <th pSortableColumn="created">Created At <p-sortIcon field="created">
                                            </p-sortIcon>
                                        </th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-product>
                                    <tr>
                                        <td>{{product.title}}</td>
                                        <td>{{product.message}}</td>
                                        <td>{{product.description}}</td>
                                        <td>{{product.created}}</td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <p-dialog [(visible)]="productDialog" [style]="{width: '600px'}" header="Send Notification" [modal]="true"
        styleClass="p-fluid">
        <ng-template pTemplate="content">
            <form [formGroup]="notificationform">
                <div class="p-field">
                    <label for="name">User</label>
                    <p-multiSelect [options]="users" formControlName="user_id" defaultLabel="Select a User"
                        display="chip"></p-multiSelect>
                    <div *ngIf="submitted && f['user_id'].errors" class="text-danger">
                        <div *ngIf="f['user_id'].errors['required']">Users is required</div>
                    </div>
                </div>
                <div class="p-field mt-2">
                    <label for="name">Title</label>
                    <input type="text" class="form-control" pInputText id="name" formControlName="title"
                        placeholder="Enter title" [ngClass]="{ 'is-invalid': submitted && f['title'].errors }" />
                    <div *ngIf="submitted && f['title'].errors" class="text-danger">
                        <div *ngIf="f['title'].errors['required']">Title is required</div>
                    </div>
                </div>
                <div class="p-field mt-2">
                    <label for="price">Message</label>
                    <textarea type="text" class="form-control" pInputText formControlName="message"
                        placeholder="Enter message"
                        [ngClass]="{ 'is-invalid': submitted && f['message'].errors }"></textarea>
                    <div *ngIf="submitted && f['message'].errors" class="text-danger">
                        <div *ngIf="f['message'].errors['required']">Message is required
                        </div>
                    </div>
                </div>
                <div class="p-field mt-2">
                    <label for="quantity">Description</label>
                    <textarea type="text" class="form-control" pInputText formControlName="description"
                        [ngClass]="{ 'is-invalid': submitted && f['description'].errors }"
                        placeholder="Enter description"></textarea>
                    <div *ngIf="submitted && f['description'].errors" class="text-danger">
                        <div *ngIf="f['description'].errors['required']">Description is
                            required
                        </div>
                    </div>
                </div>
            </form>
        </ng-template>

        <ng-template pTemplate="footer">
            <button type="submit" class="btn btn-success" (click)="saveProduct()">Save</button>
            <button type="button" class="btn btn-secondary ms-1" (click)="hideDialog()">Close</button>
        </ng-template>
    </p-dialog>
</div>